<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã - –£—á–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∏–π —Å—á–µ—Ç—á–∏–∫–æ–≤</title>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .test-section h2 {
            color: #495057;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .test-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .test-item button {
            margin-right: 10px;
            padding: 5px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .test-btn {
            background: #007bff;
            color: white;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .test-result {
            margin-left: 10px;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .log-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #e9ecef;
            border-radius: 5px;
            min-width: 120px;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #495057;
        }
        
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .clear-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .clear-btn:hover {
            background: #c82333;
        }
        
        .run-all-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .run-all-btn:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —É—á–µ—Ç–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π —Å—á–µ—Ç—á–∏–∫–æ–≤</h1>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="totalTests">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="passedTests">0</div>
                <div class="stat-label">–ü—Ä–æ–π–¥–µ–Ω–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="failedTests">0</div>
                <div class="stat-label">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="pendingTests">0</div>
                <div class="stat-label">–û–∂–∏–¥–∞–Ω–∏–µ</div>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <button class="run-all-btn" onclick="runAllTests()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
            <button class="clear-btn" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
        
        <!-- –¢–µ—Å—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
        <div class="test-section">
            <h2>üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Appwrite</h2>
            <div class="test-item">
                <button class="test-btn" onclick="testAppwriteConnection()">–¢–µ—Å—Ç</button>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Appwrite</span>
                <span class="test-result pending" id="result-connection">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            <div class="test-item">
                <button class="test-btn" onclick="testDatabaseConnection()">–¢–µ—Å—Ç</button>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</span>
                <span class="test-result pending" id="result-database">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
        </div>
        
        <!-- –¢–µ—Å—Ç—ã –∫–æ–ª–ª–µ–∫—Ü–∏–π -->
        <div class="test-section">
            <h2>üìä –ö–æ–ª–ª–µ–∫—Ü–∏–∏</h2>
            <div class="test-item">
                <button class="test-btn" onclick="testCitiesCollection()">–¢–µ—Å—Ç</button>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≥–æ—Ä–æ–¥–æ–≤</span>
                <span class="test-result pending" id="result-cities">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            <div class="test-item">
                <button class="test-btn" onclick="testMeterTypesCollection()">–¢–µ—Å—Ç</button>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ç–∏–ø–æ–≤ —Å—á–µ—Ç—á–∏–∫–æ–≤</span>
                <span class="test-result pending" id="result-meter-types">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            <div class="test-item">
                <button class="test-btn" onclick="testMetersCollection()">–¢–µ—Å—Ç</button>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤</span>
                <span class="test-result pending" id="result-meters">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            <div class="test-item">
                <button class="test-btn" onclick="testTariffsCollection()">–¢–µ—Å—Ç</button>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤</span>
                <span class="test-result pending" id="result-tariffs">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            <div class="test-item">
                <button class="test-btn" onclick="testReadingsCollection()">–¢–µ—Å—Ç</button>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π</span>
                <span class="test-result pending" id="result-readings">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
        </div>
        
        <!-- –¢–µ—Å—Ç—ã CRUD –æ–ø–µ—Ä–∞—Ü–∏–π -->
        <div class="test-section">
            <h2>üîÑ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
            <div class="test-item">
                <button class="test-btn" onclick="testCreateDocument()">–¢–µ—Å—Ç</button>
                <span>–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</span>
                <span class="test-result pending" id="result-create">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            <div class="test-item">
                <button class="test-btn" onclick="testReadDocument()">–¢–µ—Å—Ç</button>
                <span>–ß—Ç–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</span>
                <span class="test-result pending" id="result-read">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            <div class="test-item">
                <button class="test-btn" onclick="testUpdateDocument()">–¢–µ—Å—Ç</button>
                <span>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</span>
                <span class="test-result pending" id="result-update">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            <div class="test-item">
                <button class="test-btn" onclick="testDeleteDocument()">–¢–µ—Å—Ç</button>
                <span>–£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</span>
                <span class="test-result pending" id="result-delete">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
        </div>
        
        <!-- –¢–µ—Å—Ç—ã –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ -->
        <div class="test-section">
            <h2>üè¢ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞</h2>
            <div class="test-item">
                <button class="test-btn" onclick="testMeterReadingFlow()">–¢–µ—Å—Ç</button>
                <span>–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –≤–≤–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π</span>
                <span class="test-result pending" id="result-reading-flow">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            <div class="test-item">
                <button class="test-btn" onclick="testTariffCalculation()">–¢–µ—Å—Ç</button>
                <span>–†–∞—Å—á–µ—Ç –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º</span>
                <span class="test-result pending" id="result-tariff-calc">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            <div class="test-item">
                <button class="test-btn" onclick="testHistoryGeneration()">–¢–µ—Å—Ç</button>
                <span>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏</span>
                <span class="test-result pending" id="result-history">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
        </div>
        
        <!-- –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
        <div class="test-section">
            <h2>üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h2>
            <div class="test-item">
                <button class="test-btn" onclick="testAuthStatus()">–¢–µ—Å—Ç</button>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</span>
                <span class="test-result pending" id="result-auth-status">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            <div class="test-item">
                <button class="test-btn" onclick="testPermissions()">–¢–µ—Å—Ç</button>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π</span>
                <span class="test-result pending" id="result-permissions">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
        </div>
        
        <div class="log-output" id="logOutput"></div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π -->
    <script src="https://cdn.jsdelivr.net/npm/appwrite@15.0.0"></script>
    <script src="config.js"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Appwrite
        const { Client, Databases, Query, ID } = Appwrite;
        
        let client, databases;
        let testResults = {};
        let testDocument = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
        function initAppwrite() {
            try {
                client = new Client();
                databases = new Databases(client);
                
                client
                    .setEndpoint(APPWRITE_CONFIG.endpoint)
                    .setProject(APPWRITE_CONFIG.projectId);
                
                return true;
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Appwrite: ${error.message}`);
                return false;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message) {
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            logOutput.textContent += `[${timestamp}] ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ç–µ—Å—Ç–∞
        function updateTestResult(testId, status, message = '') {
            const resultElement = document.getElementById(`result-${testId}`);
            if (resultElement) {
                resultElement.className = `test-result ${status}`;
                resultElement.textContent = status === 'success' ? '–£—Å–ø–µ—à–Ω–æ' : 
                                          status === 'error' ? '–û—à–∏–±–∫–∞' : '–û–∂–∏–¥–∞–Ω–∏–µ';
                if (message) {
                    resultElement.title = message;
                }
            }
            
            testResults[testId] = { status, message };
            updateStats();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const results = Object.values(testResults);
            const total = results.length;
            const passed = results.filter(r => r.status === 'success').length;
            const failed = results.filter(r => r.status === 'error').length;
            const pending = total - passed - failed;
            
            document.getElementById('totalTests').textContent = total;
            document.getElementById('passedTests').textContent = passed;
            document.getElementById('failedTests').textContent = failed;
            document.getElementById('pendingTests').textContent = pending;
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞
        function clearLog() {
            document.getElementById('logOutput').textContent = '';
        }
        
        // –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Appwrite
        async function testAppwriteConnection() {
            log('üîå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Appwrite...');
            
            try {
                if (!initAppwrite()) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Appwrite');
                }
                
                // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
                await databases.list();
                
                log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Appwrite —É—Å–ø–µ—à–Ω–æ');
                updateTestResult('connection', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Appwrite: ${error.message}`);
                updateTestResult('connection', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        async function testDatabaseConnection() {
            log('üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...');
            
            try {
                if (!databases) {
                    throw new Error('Appwrite –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }
                
                const database = await databases.get(APPWRITE_CONFIG.databaseId);
                
                log(`‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö "${database.name}" —É—Å–ø–µ—à–Ω–æ`);
                updateTestResult('database', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`);
                updateTestResult('database', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≥–æ—Ä–æ–¥–æ–≤
        async function testCitiesCollection() {
            log('üèôÔ∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≥–æ—Ä–æ–¥–æ–≤...');
            
            try {
                const response = await databases.listDocuments(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.cities
                );
                
                log(`‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è –≥–æ—Ä–æ–¥–æ–≤: –Ω–∞–π–¥–µ–Ω–æ ${response.documents.length} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤`);
                updateTestResult('cities', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≥–æ—Ä–æ–¥–æ–≤: ${error.message}`);
                updateTestResult('cities', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ç–∏–ø–æ–≤ —Å—á–µ—Ç—á–∏–∫–æ–≤
        async function testMeterTypesCollection() {
            log('‚ö° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ç–∏–ø–æ–≤ —Å—á–µ—Ç—á–∏–∫–æ–≤...');
            
            try {
                const response = await databases.listDocuments(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.meterTypes
                );
                
                log(`‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è —Ç–∏–ø–æ–≤ —Å—á–µ—Ç—á–∏–∫–æ–≤: –Ω–∞–π–¥–µ–Ω–æ ${response.documents.length} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤`);
                updateTestResult('meter-types', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ç–∏–ø–æ–≤ —Å—á–µ—Ç—á–∏–∫–æ–≤: ${error.message}`);
                updateTestResult('meter-types', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤
        async function testMetersCollection() {
            log('üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤...');
            
            try {
                const response = await databases.listDocuments(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.meters
                );
                
                log(`‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤: –Ω–∞–π–¥–µ–Ω–æ ${response.documents.length} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤`);
                updateTestResult('meters', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤: ${error.message}`);
                updateTestResult('meters', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤
        async function testTariffsCollection() {
            log('üí∞ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤...');
            
            try {
                const response = await databases.listDocuments(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.tariffs
                );
                
                log(`‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤: –Ω–∞–π–¥–µ–Ω–æ ${response.documents.length} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤`);
                updateTestResult('tariffs', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤: ${error.message}`);
                updateTestResult('tariffs', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π
        async function testReadingsCollection() {
            log('üìà –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π...');
            
            try {
                const response = await databases.listDocuments(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.meterReadings
                );
                
                log(`‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞–Ω–∏–π: –Ω–∞–π–¥–µ–Ω–æ ${response.documents.length} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤`);
                updateTestResult('readings', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π: ${error.message}`);
                updateTestResult('readings', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
        async function testCreateDocument() {
            log('‚ûï –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞...');
            
            try {
                const testData = {
                    name: `–¢–µ—Å—Ç–æ–≤—ã–π –≥–æ—Ä–æ–¥ ${Date.now()}`
                };
                
                testDocument = await databases.createDocument(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.cities,
                    ID.unique(),
                    testData
                );
                
                log(`‚úÖ –î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω —Å ID: ${testDocument.$id}`);
                updateTestResult('create', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞: ${error.message}`);
                updateTestResult('create', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
        async function testReadDocument() {
            log('üëÅÔ∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á—Ç–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞...');
            
            try {
                if (!testDocument) {
                    throw new Error('–ù–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è');
                }
                
                const document = await databases.getDocument(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.cities,
                    testDocument.$id
                );
                
                log(`‚úÖ –î–æ–∫—É–º–µ–Ω—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω: ${document.name}`);
                updateTestResult('read', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞: ${error.message}`);
                updateTestResult('read', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
        async function testUpdateDocument() {
            log('‚úèÔ∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞...');
            
            try {
                if (!testDocument) {
                    throw new Error('–ù–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
                }
                
                const updatedData = {
                    name: `–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≥–æ—Ä–æ–¥ ${Date.now()}`
                };
                
                const updatedDocument = await databases.updateDocument(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.cities,
                    testDocument.$id,
                    updatedData
                );
                
                log(`‚úÖ –î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω: ${updatedDocument.name}`);
                updateTestResult('update', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞: ${error.message}`);
                updateTestResult('update', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
        async function testDeleteDocument() {
            log('üóëÔ∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞...');
            
            try {
                if (!testDocument) {
                    throw new Error('–ù–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                }
                
                await databases.deleteDocument(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.cities,
                    testDocument.$id
                );
                
                log(`‚úÖ –î–æ–∫—É–º–µ–Ω—Ç —É–¥–∞–ª–µ–Ω: ${testDocument.$id}`);
                updateTestResult('delete', 'success');
                testDocument = null;
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞: ${error.message}`);
                updateTestResult('delete', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –≤–≤–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π
        async function testMeterReadingFlow() {
            log('üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –≤–≤–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π...');
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Å—á–µ—Ç—á–∏–∫
                const metersResponse = await databases.listDocuments(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.meters,
                    [Query.limit(1)]
                );
                
                if (metersResponse.documents.length === 0) {
                    throw new Error('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                }
                
                const meter = metersResponse.documents[0];
                const currentDate = new Date().toISOString();
                const testReading = Math.random() * 1000;
                
                // –°–æ–∑–¥–∞–µ–º –ø–æ–∫–∞–∑–∞–Ω–∏–µ
                const readingData = {
                    meter_id: meter.$id,
                    reading_date: currentDate,
                    reading: testReading
                };
                
                const reading = await databases.createDocument(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.meterReadings,
                    ID.unique(),
                    readingData
                );
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
                await databases.updateDocument(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.meters,
                    meter.$id,
                    {
                        prev_date: currentDate,
                        prev_reading: testReading
                    }
                );
                
                log(`‚úÖ –¶–∏–∫–ª –≤–≤–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω: ${testReading.toFixed(2)}`);
                updateTestResult('reading-flow', 'success');
                
                // –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ
                await databases.deleteDocument(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.meterReadings,
                    reading.$id
                );
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ü–∏–∫–ª–∞ –≤–≤–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π: ${error.message}`);
                updateTestResult('reading-flow', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç —Ä–∞—Å—á–µ—Ç–∞ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º
        async function testTariffCalculation() {
            log('üí∞ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º...');
            
            try {
                const tariffsResponse = await databases.listDocuments(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.tariffs,
                    [Query.limit(1)]
                );
                
                if (tariffsResponse.documents.length === 0) {
                    throw new Error('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                }
                
                const tariff = tariffsResponse.documents[0];
                const consumption = 100;
                const amount = consumption * tariff.tariff;
                
                log(`‚úÖ –†–∞—Å—á–µ—Ç –ø–æ —Ç–∞—Ä–∏—Ñ—É: ${consumption} √ó ${tariff.tariff} = ${amount.toFixed(2)}`);
                updateTestResult('tariff-calc', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º: ${error.message}`);
                updateTestResult('tariff-calc', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏
        async function testHistoryGeneration() {
            log('üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏...');
            
            try {
                const readingsResponse = await databases.listDocuments(
                    APPWRITE_CONFIG.databaseId,
                    APPWRITE_CONFIG.collections.meterReadings,
                    [Query.limit(10)]
                );
                
                log(`‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞: –Ω–∞–π–¥–µ–Ω–æ ${readingsResponse.documents.length} –∑–∞–ø–∏—Å–µ–π`);
                updateTestResult('history', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏: ${error.message}`);
                updateTestResult('history', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function testAuthStatus() {
            log('üîê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–∫–ª—é—á–µ–Ω –ª–∏ –º–æ–¥—É–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                if (typeof authManager !== 'undefined') {
                    const isLoggedIn = authManager.isLoggedIn();
                    const user = authManager.getCurrentUser();
                    
                    log(`‚úÖ –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${isLoggedIn ? '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' : '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'}`);
                    if (user) {
                        log(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.name} (${user.email})`);
                    }
                } else {
                    log('‚ö†Ô∏è –ú–æ–¥—É–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
                }
                
                updateTestResult('auth-status', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${error.message}`);
                updateTestResult('auth-status', 'error', error.message);
            }
        }
        
        // –¢–µ—Å—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
        async function testPermissions() {
            log('üõ°Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∫–æ–ª–ª–µ–∫—Ü–∏—è–º
                const collections = Object.entries(APPWRITE_CONFIG.collections);
                let accessibleCollections = 0;
                
                for (const [name, id] of collections) {
                    try {
                        await databases.listDocuments(
                            APPWRITE_CONFIG.databaseId,
                            id,
                            [Query.limit(1)]
                        );
                        accessibleCollections++;
                    } catch (error) {
                        log(`‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ ${name}: ${error.message}`);
                    }
                }
                
                log(`‚úÖ –î–æ—Å—Ç—É–ø –∫ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º: ${accessibleCollections}/${collections.length}`);
                updateTestResult('permissions', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π: ${error.message}`);
                updateTestResult('permissions', 'error', error.message);
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
        async function runAllTests() {
            log('üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤...');
            
            const tests = [
                testAppwriteConnection,
                testDatabaseConnection,
                testCitiesCollection,
                testMeterTypesCollection,
                testMetersCollection,
                testTariffsCollection,
                testReadingsCollection,
                testCreateDocument,
                testReadDocument,
                testUpdateDocument,
                testDeleteDocument,
                testMeterReadingFlow,
                testTariffCalculation,
                testHistoryGeneration,
                testAuthStatus,
                testPermissions
            ];
            
            for (const test of tests) {
                try {
                    await test();
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
                    await new Promise(resolve => setTimeout(resolve, 500));
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–∞: ${error.message}`);
                }
            }
            
            log('üèÅ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            log('üß™ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            log('–ù–∞—Å—Ç—Ä–æ–π—Ç–µ config.js –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫–∏
            updateStats();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
            if (typeof APPWRITE_CONFIG === 'undefined') {
                log('‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è APPWRITE_CONFIG –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            } else if (!APPWRITE_CONFIG.projectId || APPWRITE_CONFIG.projectId === 'YOUR_PROJECT_ID') {
                log('‚ö†Ô∏è –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω Project ID –≤ config.js');
            } else {
                log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                initAppwrite();
            }
        });
    </script>
</body>
</html> 